import MultiStepIndicator from "../MultiStepIndicator";
import { useCallback, useEffect, useMemo, useState } from "react";
import { ArgsTable, Canvas, Meta, Story } from "@storybook/addon-docs";
import { STEP_STATUSES } from "../MultiStepConstants";
import { createComponentTemplate } from "../../../storybook/functions/createComponentTemplate";
import { BREADCRUBMS, STEPPER, TABS } from "../../../storybook/components/related-components/component-description-map";
import { firstSteps, secondSteps, thirdSteps } from "./helper.js";
import { Link } from "../../../storybook/components";
import { Featured, Close } from "../../Icon/Icons";
import "./multiStepIndicator.stories.scss";

<Meta title="Navigation/Wizard" component={MultiStepIndicator} />

<!--- Component template -->

export const multiStepIndicatorTemplate = createComponentTemplate(MultiStepIndicator);

<!--- Component documentation -->

# Wizard

- [Overview](#overview)
- [Props](#props)
- [Usage](#usage)
- [Variants](#variants)
- [Do’s and don’ts](#dos-and-donts)
- [Use cases and examples](#use-cases-and-examples)
- [Related components](#related-components)
- [Feedback](#feedback)

## Overview

Tabular navigation component that helps users visualize and interact with a multi-step process.

<Canvas>
  <Story
    name="Overview"
    args={{
      steps: [
        {
          key: "FULFILLED",
          status: MultiStepIndicator.stepStatuses.FULFILLED,
          titleText: "Heading",
          subtitleText: "Heading"
        },
        {
          key: "PENDING",
          status: MultiStepIndicator.stepStatuses.PENDING,
          titleText: "Heading",
          subtitleText: "Heading"
        },
        {
          key: "PENDING-2",
          status: MultiStepIndicator.stepStatuses.PENDING,
          titleText: "Heading",
          subtitleText: "Heading"
        }
      ]
    }}
  >
    {multiStepIndicatorTemplate.bind({})}
  </Story>
</Canvas>

## Props

<ArgsTable of={MultiStepIndicator} />

## Usage

<UsageGuidelines
  guidelines={[
    "Use wizard to break a larger goal into manageable steps.",
    "If a workflow needs more than 6 steps, consider how you might simplify it or break it up into multiple tasks.",
    "Always position the wizard at the top of the multi-step process so that the user has a common reference point as they move between steps."
  ]}
/>

<Tip title="Not what you were looking for?">
  In order to navigate between content withouht a liniar progress, use the{" "}
  <Link href="/?path=/docs/navigation-tabs-tabs--overview" size={Link.sizes.SMALL} withoutSpacing>
    Tabs
  </Link>{" "}
  or{" "}
  <Link href="/?path=/docs/buttons-buttongroup--overview" size={Link.sizes.SMALL} withoutSpacing>
    Button group
  </Link>{" "}
  component.
</Tip>

## Variants

### Placements

Vertical

<Canvas>
  <Story name="Vertical">
    {() => {
      const steps = useMemo(
        () => [
          {
            key: "FULFILLED",
            status: MultiStepIndicator.stepStatuses.FULFILLED,
            titleText: "Heading",
            subtitleText: "Heading"
          },
          {
            key: "ACTIVE",
            status: MultiStepIndicator.stepStatuses.ACTIVE,
            titleText: "Heading",
            subtitleText: "Heading"
          },
          {
            key: "PENDING",
            status: MultiStepIndicator.stepStatuses.PENDING,
            titleText: "Heading",
            subtitleText: "Heading"
          }
        ],
        []
      );
      return (
        <div className="l3-storybook-VerticalMultiStepIndicator">
          <div className="l3-storybook-VerticalMultiStepIndicator-column">
            <span className="l3-storybook-VerticalMultiStepIndicator-text">Primary</span>
            <MultiStepIndicator
              steps={steps}
              textPlacement={MultiStepIndicator.textPlacements.VERTICAL}
              isFulfilledStepDisplayNumber={true}
              type={MultiStepIndicator.types.PRIMARY}
            />
          </div>
          <div className="l3-storybook-VerticalMultiStepIndicator-row">
            <span className="l3-storybook-VerticalMultiStepIndicator-text">Positive</span>
            <MultiStepIndicator
              steps={steps}
              type={MultiStepIndicator.types.POSITIVE}
              textPlacement={MultiStepIndicator.textPlacements.VERTICAL}
            />
          </div>
          <div className="l3-storybook-VerticalMultiStepIndicator-row">
            <span className="l3-storybook-VerticalMultiStepIndicator-text">Negative</span>
            <MultiStepIndicator
              steps={steps}
              fulfilledStepIcon={Close}
              type={MultiStepIndicator.types.NEGATIVE}
              textPlacement={MultiStepIndicator.textPlacements.VERTICAL}
            />
          </div>
          <div className="l3-storybook-VerticalMultiStepIndicator-row">
            <span className="l3-storybook-VerticalMultiStepIndicator-text">Secondary</span>
            <MultiStepIndicator
              steps={steps}
              type={MultiStepIndicator.types.SECONDARY}
              textPlacement={MultiStepIndicator.textPlacements.VERTICAL}
            />
          </div>
        </div>
      );
    }}
  </Story>
</Canvas>

### Horizontal

There are 4 types: Primary, positive, negative, secondary.

<Canvas>
  <Story name="Horizontal">
    {() => {
      const steps = useMemo(
        () => [
          {
            key: "FULFILLED",
            status: MultiStepIndicator.stepStatuses.FULFILLED,
            titleText: "Heading",
            subtitleText: "Heading"
          },
          {
            key: "ACTIVE",
            status: MultiStepIndicator.stepStatuses.ACTIVE,
            titleText: "Heading",
            subtitleText: "Heading"
          },
          {
            key: "PENDING",
            status: MultiStepIndicator.stepStatuses.PENDING,
            titleText: "Heading",
            subtitleText: "Heading"
          }
        ],
        []
      );
      return (
        <div className="l3-storybook-multiStepIndicator_column-wrapper">
          <div className="l3-storybook-multiStepIndicator_row-wrapper">
            <span className="l3-storybook-multiStepIndicator_title">Primary</span>
            <MultiStepIndicator
              steps={steps}
              isFulfilledStepDisplayNumber={true}
              type={MultiStepIndicator.types.PRIMARY}
            />
          </div>
          <div className="l3-storybook-multiStepIndicator_row-wrapper">
            <span className="l3-storybook-multiStepIndicator_title">Positive</span>
            <MultiStepIndicator steps={steps} type={MultiStepIndicator.types.POSITIVE} />
          </div>
          <div className="l3-storybook-multiStepIndicator_row-wrapper">
            <span className="l3-storybook-multiStepIndicator_title">Negative</span>
            <MultiStepIndicator steps={steps} fulfilledStepIcon={Close} type={MultiStepIndicator.types.NEGATIVE} />
          </div>
          <div className="l3-storybook-multiStepIndicator_row-wrapper">
            <span className="l3-storybook-multiStepIndicator_title">Secondary</span>
            <MultiStepIndicator steps={steps} type={MultiStepIndicator.types.SECONDARY} />
          </div>
        </div>
      );
    }}
  </Story>
</Canvas>

### Transition Animation

State transition automatic example

<Canvas>
  <Story name="Transition Animation">
    {() => {
      const exampleSteps = useMemo(
        () => ({
          firstStep: {
            key: "PENDING",
            status: MultiStepIndicator.stepStatuses.PENDING,
            titleText: "Heading",
            subtitleText: "Heading"
          },
          secondStep: {
            key: "PENDING-2",
            status: MultiStepIndicator.stepStatuses.PENDING,
            titleText: "Heading",
            subtitleText: "Heading"
          },
          thirdStep: {
            key: "PENDING-3",
            status: MultiStepIndicator.stepStatuses.PENDING,
            titleText: "Heading",
            subtitleText: "Heading"
          }
        }),
        []
      );
      const [steps, setSteps] = useState([
        { ...exampleSteps.firstStep },
        { ...exampleSteps.secondStep },
        { ...exampleSteps.thirdStep }
      ]);
      const clearSteps = useCallback(() => {
        setSteps([{ ...exampleSteps.firstStep }, { ...exampleSteps.secondStep }, { ...exampleSteps.thirdStep }]);
      }, [setSteps]);
      const [numActions, setNumActions] = useState(0);
      const getStepKeyForTransition = useCallback(() => {
        if (numActions < 2) return "firstStep";
        else if (numActions < 4) return "secondStep";
        else return "thirdStep";
      }, [numActions]);
      const STEP_TRANSITIONS = useMemo(
        () => ({
          [STEP_STATUSES.PENDING]: STEP_STATUSES.ACTIVE,
          [STEP_STATUSES.ACTIVE]: STEP_STATUSES.FULFILLED,
          [STEP_STATUSES.FULFILLED]: STEP_STATUSES.PENDING
        }),
        []
      );
      const performIndicatorStateTransition = useCallback(() => {
        if (numActions === steps.length * 2) {
          clearSteps();
          setNumActions(0);
          return;
        }
        const stepKey = getStepKeyForTransition();
        const copySteps = { firstStep: { ...steps[0] }, secondStep: { ...steps[1] }, thirdStep: { ...steps[2] } };
        copySteps[stepKey].status = STEP_TRANSITIONS[copySteps[stepKey].status];
        setSteps([{ ...copySteps.firstStep }, { ...copySteps.secondStep }, { ...copySteps.thirdStep }]);
        setNumActions(numActions + 1);
      }, [steps, setSteps, numActions, setNumActions]);
      useEffect(() => {
        const interval = setInterval(performIndicatorStateTransition, 2000);
        return () => {
          clearInterval(interval);
        };
      }, [performIndicatorStateTransition]);
      return <MultiStepIndicator steps={steps} />;
    }}
  </Story>
</Canvas>

## Do’s and Don’ts

<ComponentRules
  rules={[
    {
      positive: {
        component: (
          <MultiStepIndicator
            steps={firstSteps}
            textPlacement={MultiStepIndicator.textPlacements.VERTICAL}
            className="l3-storybook-multiStepIndicator_big-size"
          />
        ),
        description:
          "Be consistent with the information you include under each step. If you’re using a subtitle on one step, use for all steps."
      },
      negative: {
        component: (
          <MultiStepIndicator
            steps={secondSteps}
            textPlacement={MultiStepIndicator.textPlacements.VERTICAL}
            className="l3-storybook-multiStepIndicator_big-size"
          />
        ),
        description: "Don’t place subheader on one step only."
      }
    }
  ]}
/>

## Related components

<RelatedComponents componentsNames={[TABS, BREADCRUBMS, STEPPER]} />
